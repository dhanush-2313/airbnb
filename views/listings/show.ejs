<%layout("/layouts/boilerplate") %>
<div class="row mt-3 mx-auto">
  <div class="col-8 mx-auto">
    <h3><%=listing.title %></h3>
  </div>
  <div class="card col-8 mx-auto show-card listing-card">
      <img
        src="<%=listing.image%>"
        class="card-img-top show-img"
        alt="listing_image"
      />
      <div class="card-body">
        <p class="card-text">Owned By <i><%= listing.owner.username %></i></p>
          <p class="card-text"><%=listing.description %> </p>
          <p class="card-text">&#8377;<%=listing.price.toLocaleString("en-IN") %> </p>
          <p class="card-text"><%=listing.location %> </p>
          <p class="card-text"><%=listing.country %> </p>
        
      </div>
  </div>
</div>

<% if(currUser && listing.owner._id.equals(currUser._id)) {%>
<div class="btns">
  <a
    href="/listings/<%=listing._id%>/edit"
    class="btn btn-dark offset-2 add-btn"
    >Edit</a
  >
  <form action="/listings/<%= listing._id %>?_method=DELETE" method="POST">
    <button class="btn btn-dark" style="margin-left: 1rem !important;">Delete</button>
  </form>
</div>
<% } %>


<div class="col-8 mx-auto mb-3">
    <hr>
    <% if(currUser){ %>
    <h4>Leave a Review</h4>
    <form action="/listings/<%=listing.id%>/reviews" method="POST" novalidate class="needs-validation">
      <div class="mb-3 mt-3">
        <label for="rating" class="form-label">Rating</label>
        <input type="range" min="1" max="5"  name="review[rating]" id="rating" class="form-range" >
      </div>
      <div class="mb-3 mt-3">
        <label for="comment" class="form-label">Comments</label>
        <textarea name="review[comment]" id="comment" rows="5" cols="30" class="form-control" required></textarea>
        <div class="invalid-feedback">Please add some comments for review</div>
      </div>
      <div>
        <button class="btn btn-outline-dark">Submit</button>
      </div>
    </form>
    <% } %>

    <p><b>All reviews</b></p>
    <div class="row">
      <% for(review of listing.reviews){  %>
       <div class="card col-5 ms-3 mb-3" style="border: 1px solid rgba(0, 0, 0, 0.2) !important;"> 
        <div class="card-body">
          <h5 class="card-title mt-2">@<%= review.author.username %></h5>
        <div class="card-text">
          <div class="review-text">
            <%= review.comment %>
          </div>
          <div class="review-rating">
            <span class="badge bg-dark mt-2" style="font-size: 1rem !important;"><%= review.rating %></span>
          </div>
          <!-- <button class="read-more btn btn-link" style="display: none;">Read More</button> -->
        </div>
        </div>
        <form class="mb-3" method="POST" action="/listings/<%= listing._id %>/reviews/<%= review._id%>?_method=DELETE">
          <button class="btn btn-sm btn-dark mt-2">Delete review</button>
        </form>
       </div>
      
      <% } %>
    </div>
  </div>